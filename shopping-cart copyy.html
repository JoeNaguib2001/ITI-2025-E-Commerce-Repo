<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shopping cart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./css/shoppingcartstyle.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <style>

        /* .left-side img{
            width: 100px;
            height: 100px;
        } */
    </style>
</head>

<body>
    <!-- <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
        <div id="navbar"></div>
        <div class="great-container" style="width: 80%; border: 3px solid blue;">
            <div class="container" style="border:30px solid red">
                <div class="row">
                    <section class="left-side col-12 col-md-8">
                        <h1 class="title"><span class="number-of-items">0</span></h1>
                        <section class="cart-items-container">
                        </section>
                    </section>
                    <section class="right-side col-12 col-md-4">
                        <div class="order-summary">
                            <h1>Order Summary</h1>
                            <p id="subtotal"></p>
                            <p id="tax"></p>
                            <p id="total"></p>
                        </div>
                        <button class="checkout-btn">Checkout</button>
                    </section>
                </div>
            </div>
        </div>
    </div> -->

    <!-- <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
        <div id="navbar"></div>
        <div class="row" style="margin: 100px 5%; border: 1px solid red;">
            <section class="left-side col-12 col-md-9">
                <h1 class="title"><span class="number-of-items">Items Count: 0</span></h1>
                <section class="cart-items-container">
                   Cart items will be dynamically loaded here
                </section>
                <section class="col-12 col-md-3">
                    2
                </section>
        </div>
    </div> -->

    <!-- </div> -->

    <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
        <div id="navbar"></div>
        <div class="container" style="margin: 50px auto; max-width: 1200px;">
            <div class="row">
                <!-- Left Side: Cart Items -->
                <section class="left-side col-12 col-md-8">
                    <h1 class="title"><span class="number-of-items">Items Count: 0</span></h1>
                    <section class="cart-items-container">
                        <!-- Cart items will be dynamically loaded here -->
                    </section>
                </section>

                <!-- Right Side: Order Summary -->
                <section class="right-side col-12 col-md-4">
                    <div class="order-summary p-3 border rounded">
                        <h2>Order Summary</h2>
                        <p id="subtotal">Subtotal = $0.00</p>
                        <p id="tax">Tax = $0.00</p>
                        <p id="total">Total = $0.00</p>
                        <button class="checkout-btn btn btn-primary w-100 mt-3">Checkout</button>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./navbar/navbar.js"></script>

    <script>

        let cartItems;
        function getCurrentLoggedInUserCartOrderedItems() {
            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);
            let cartItems = userCart ? userCart.order : [];
            return cartItems;
        }

        function loadCartItems() {
            cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©
            const cartContainer = document.querySelector(".cart-items-container");
            cartContainer.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

            if (cartItems.length === 0) {
                cartContainer.innerHTML = "<h2>The Cart Is Empty ðŸ›’</h2>";
                return;
            }

            cartItems.forEach((item, index) => {
                const cartItemDiv = document.createElement("div");
                cartItemDiv.classList.add("cart-item");

                cartItemDiv.innerHTML = `
                            <div class="image-div"><img src="${item.image}" alt="${item.title}"></div>
                            <div class="cart-item-info">
                                <div style="display: flex; justify-content: space-between;">
                                    <h2 class="product-name">${item.title}</h2>
                                    <span class="product-price">Price: $${item.price}</span>
                                </div>
                                <div>
                                    <span class="real-quantity">In Stock</span>
                                    <br>
                                    <span class="delivery-status">Eligible for Free delivery</span>
                                    <br>
                                    <span class="details">Details</span>
                                    <br>
                                    <div class="product-quantity">
                                        <i class="fa-solid fa-minus decrease-quantity" data-index="${index}"></i>
                                        <span>${item.quantity}</span>
                                        <i class="fa-solid fa-plus increase-quantity" data-index="${index}"></i>
                                    </div>
                                    <a class="action remove-item" href="#" data-index="${index}">Delete</a>
                                    <a class="action save-later" href="#">Save for later</a>
                                    <a class="action share" href="#">Share</a>
                                </div>
                            </div>
                            
                        `;

                cartContainer.appendChild(cartItemDiv);
            });

            setupCartActions();
        }

        function setupCartActions() {
            document.querySelectorAll(".decrease-quantity").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    decreaseQuantity(index);
                });
            });

            document.querySelectorAll(".increase-quantity").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    increaseQuantity(index);
                });
            });

            document.querySelectorAll(".remove-item").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    deleteItem(index);
                });
            });
        }

        function increaseQuantity(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©

            cartItems[index].quantity += 1; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ù…Ù‚Ø¯Ø§Ø± 1

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            } else {
                carts.push({ username: username, order: cartItems }); // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            updateCartCount();
        }


        function decreaseQuantity(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©

            if (cartItems[index].quantity > 1) {
                cartItems[index].quantity -= 1; // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ù…Ù‚Ø¯Ø§Ø± 1
            } else {
                cartItems.splice(index, 1); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙˆØµÙ„Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ 0
            }

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            } else {
                carts.push({ username: username, order: cartItems }); // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            updateCartCount();
        }

        function deleteItem(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©

            cartItems.splice(index, 1); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ø±Ø³

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            } else {
                carts.push({ username: username, order: cartItems }); // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            updateCartCount();
        }

        function clearCart() {
            localStorage.removeItem("cart");
            loadCartItems();
        }

        function updateOrderSummary() {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©
            let subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let tax = subtotal * 0.1; // Ù†ÙØªØ±Ø¶ 10% Ø¶Ø±ÙŠØ¨Ø©
            let total = subtotal + tax;

            document.getElementById("subtotal").textContent = `Subtotal = $${subtotal.toFixed(2)}`;
            document.getElementById("tax").textContent = `Tax = $${tax.toFixed(2)}`;
            document.getElementById("total").textContent = `Total = $${total.toFixed(2)}`;
        }

        function loadShoppingCartNumber() {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©
            let totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.querySelector(".number-of-items").textContent = "Items Count: " + totalItems;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener("DOMContentLoaded", () => {
            loadCartItems();
            updateOrderSummary();
            loadShoppingCartNumber();
        });
    </script>


</body>

</html>