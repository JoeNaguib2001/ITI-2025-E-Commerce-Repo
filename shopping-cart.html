<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shopping cart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./css/main-colors.css">
    <!-- <link rel="stylesheet" href="./css/shopstyle.css"> -->
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <style>
        *{
            margin: 0 !important;
        }

        a {
            text-decoration: none !important;
        }

        .action {
            color: #2162A1;
            border-left: 1px solid black;
            padding: 10px 20px;
            transition: .3s;
        }

        @media (max-width: 768px) {
            .action {
                padding: 5px 4px;
                font-size: 12px;
            }
        }

        .action:nth-of-type(1) {
            border-left: none;
        }


        .action:nth-of-type(1):hover {
            background-color: red;
            color: white;
        }

        .action:hover {
            background-color: #2162A1;
            color: white;
            cursor: pointer;
        }

        .product-quantity {
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 30px;
            border: 5px solid gold;
            margin-top: 10px auto;
            gap: 15px;
            padding: 5px;
            transition: .3s;
            min-width: 30%;
            max-width: 50%;
        }

        @media (max-width: 768px) {
            .product-quantity {
                max-width: 100%;
            }
        }

        .product-quantity span::before,
        .product-quantity span::after {
            content: "|";
            /* ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿßÿµŸÑ */
            color: black;
            /* ŸÑŸàŸÜ ÿßŸÑŸÅÿßÿµŸÑ */
            font-weight: bold;
            position: absolute;
        }

        .product-quantity span::before {
            left: -6px;
            /* ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÅÿßÿµŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ±ŸÇŸÖ */
        }

        .product-quantity span::after {
            right: -6px;
            /* ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÅÿßÿµŸÑ ÿ®ÿπÿØ ÿßŸÑÿ±ŸÇŸÖ */
        }




        .product-quantity i {
            cursor: pointer;
        }

        .product-quantity i:hover {
            color: gold;
        }

        @media (max-width: 768px) {
            .product-quantity {
                min-width: 15%;
                padding: 5px 5px;
            }
        }

        .product-quantity span {
            position: relative;
            font-size: 18px;
            font-weight: bold;
            padding: 0 12px;
            /* ŸÖÿ≥ÿßŸÅÿ© ÿ≠ŸàŸÑ ÿßŸÑÿ±ŸÇŸÖ */
        }

        .product-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .product-details {
            padding-top: 5%;
        }


        @media (max-width: 768px) {
            .product-details {
                margin: 0;
                padding: 5% 5% 20px 15% !important;
                display: flex;
                flex-direction: column;
                align-items: center;
            }



        }

        .product-image {
            border: 1px solid black;
        }

        .row img {
            height: 400px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .row img {
                width: 100%;
                height: 200px;
            }
        }

        p,
        h5 {
            font-weight: 500;
        }

        @media (max-width: 990px) {

            p,
            span,
            i,
            button {
                font-size: 10px !important;
            }

            h5 {
                font-size: 15px !important;
            }
        }
    </style>
</head>
<!-- <div class="image-div"><img src="${item.image}" alt="${item.title}"></div>
<div class="cart-item-info">
    <div style="display: flex; justify-content: space-between;">
        <h2 class="product-name">${item.title}</h2>
        <span class="product-price">Price: $${item.price}</span>
    </div>
    <div>
        <span class="real-quantity">In Stock</span>
        <br>
        <span class="delivery-status">Eligible for Free delivery</span>
        <br>
        <span class="details">Details</span>
        <br>
        <div class="product-quantity">
            <i class="fa-solid fa-minus decrease-quantity" data-index="${index}"></i>
            <span>${item.quantity}</span>
            <i class="fa-solid fa-plus increase-quantity" data-index="${index}"></i>
        </div>
        <a class="action remove-item" href="#" data-index="${index}">Delete</a>
        <a class="action save-later" href="#">Save for later</a>
        <a class="action share" href="#">Share</a>
    </div>
</div> -->

<body>
    <div class="container-fluid">
        <div class="row m-5 main-container">
            <div class="col-12 col-md-9" style=" padding:0; margin:0; border:2px solid black;">
                <div class="cart-items" style="margin: 0; padding: 0;">

                </div>
            </div>
            <div class="col-12 col-md-3" style="padding: 20px; margin: 0; border:2px solid black;">
                <div class=" cart-summary"
                    style=" padding:20px 5px; display: flex; flex-direction: column; align-items: center;">
                    <h5 style="border: 2px solid black; width: 100%; text-align: center; padding: 10px;">Cart Summary
                    </h5>
                    <p class="cart-summary-total m-3">Total Items: 1</p>
                    <p id="subtotal" class="m-3">Subtotal = $10.00</p>
                    <p id="tax" class="m-3">Tax = $1.00</p>
                    <p id="total" class="m-3">Total = $11.00</p>
                    <button class="btn btn-primary checkout-btn m-3" style="min-width: 60%;">Checkout</button>
                </div>
            </div>
            <!-- Repeat for other products -->
        </div>
    </div>
    <script src="./navbar/navbar.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script>
        let cartItems;
        function getCurrentLoggedInUserCartOrderedItems() {
            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);
            let cartItems = userCart ? userCart.order : [];
            return cartItems;
        }

        function loadCartItems() {
            cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©
            const cartContainer = document.querySelector(".cart-items");
            cartContainer.innerHTML = ""; // ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©

            if (cartItems.length === 0) {
                cartContainer.innerHTML = "<h2>The Cart Is Empty üõí</h2>";
                cartContainer.style.textAlign = "center";
                return;
            }

            cartItems.forEach((item, index) => {
                const cartItemDiv = document.createElement("div");
                cartItemDiv.classList.add("cart-item");

                cartItemDiv.innerHTML = `
                                <div class="cart-item row" data-index="0" style="padding: 20px 40px;">
                                    <div class="product-image col-6 col-md-4">
                                        <img src="${item.image}" alt="Product 1" >
                                    </div>
                                    <div class="product-details col-6 col-md-8">
                                        <p style="text-align: center;">${item.title}</p>
                                        <p style="text-align: center;"class="price">Price: $${item.price}</p>
                                        <p style="text-align: center;"class="real-quantity">In Stock</p>
                                        <div class="d-flex justify-content-center align-items-center">
                                        <div class="product-quantity">
                                            <i class="fa-solid fa-minus decrease-quantity" data-index="${index}"></i>
                                            <span>${item.quantity}</span>
                                            <i class="fa-solid fa-plus increase-quantity" data-index="${index}"></i>
                                    </div>
                                </div>
                            <div class="product-actions">
                                <a class="action remove-item" href="#" data-index="${index}">Delete</a>
                                <a class="action save-later" href="#">Save</a>
                                <a class="action share" href="#">Share</a>
                            </div>
                        </div>
                    </div>
                    <hr style="height: 5px; background-color: black; border: none;">
                            `;

                cartContainer.appendChild(cartItemDiv);
            });

            setupCartActions();
        }

        function setupCartActions() {
            document.querySelectorAll(".decrease-quantity").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    decreaseQuantity(index);
                });
            });

            document.querySelectorAll(".increase-quantity").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    increaseQuantity(index);
                });
            });

            document.querySelectorAll(".remove-item").forEach(btn => {
                btn.addEventListener("click", function () {
                    let index = this.dataset.index;
                    deleteItem(index);
                });
            });
        }

        function increaseQuantity(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©

            cartItems[index].quantity += 1; // ÿ≤ŸäÿßÿØÿ© ÿßŸÑŸÉŸÖŸäÿ© ÿ®ŸÖŸÇÿØÿßÿ± 1

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            } else {
                carts.push({ username: username, order: cartItems }); // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØŸãÿß
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿπÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            updateCartCount();
        }


        function decreaseQuantity(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©

            if (cartItems[index].quantity > 1) {
                cartItems[index].quantity -= 1; // ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑŸÉŸÖŸäÿ© ÿ®ŸÖŸÇÿØÿßÿ± 1
            } else {
                cartItems.splice(index, 1); // ÿ≠ÿ∞ŸÅ ÿßŸÑÿπŸÜÿµÿ± ÿ•ÿ∞ÿß ŸàÿµŸÑÿ™ ÿßŸÑŸÉŸÖŸäÿ© ÿ•ŸÑŸâ 0
            }

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            } else {
                carts.push({ username: username, order: cartItems }); // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØŸãÿß
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿπÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            updateCartCount();
        }

        function deleteItem(index) {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©

            cartItems.splice(index, 1); // ÿ≠ÿ∞ŸÅ ÿßŸÑÿπŸÜÿµÿ± ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÅŸáÿ±ÿ≥

            let username = localStorage.getItem("username");
            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (userCart) {
                userCart.order = cartItems; // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            } else {
                carts.push({ username: username, order: cartItems }); // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØŸãÿß
            }

            localStorage.setItem("carts", JSON.stringify(carts));
            loadCartItems();
            updateOrderSummary(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿπÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
            updateCartCount();
        }

        function clearCart() {
            localStorage.removeItem("cart");
            loadCartItems();
        }

        function updateOrderSummary() {
            updateCartSummary(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿ≥ŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©
            let subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let tax = subtotal * 0.1; // ŸÜŸÅÿ™ÿ±ÿ∂ 10% ÿ∂ÿ±Ÿäÿ®ÿ©
            let total = subtotal + tax;

            document.getElementById("subtotal").textContent = `Subtotal = $${subtotal.toFixed(2)}`;
            document.getElementById("tax").textContent = `Tax = $${tax.toFixed(2)}`;
            document.getElementById("total").textContent = `Total = $${total.toFixed(2)}`;
        }


        function getCurrentLoggedInuserCartItemsCount() {
            let cart = getCurrentLoggedInUserCartOrderedItems();
            let totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            return totalItems;
        }

        function updateCartSummary() {
            let cartSummaryTotal = document.querySelector(".cart-summary-total");
            cartSummaryTotal.innerHTML = "Total Items Count: " + getCurrentLoggedInuserCartItemsCount(); // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
        }

        loadCartItems();
        updateOrderSummary();

        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        // document.addEventListener("DOMContentLoaded", () => {
        //     loadCartItems();
        //     updateOrderSummary();
        // });

        document.querySelector(".checkout-btn").addEventListener("click", (event) => {
            event.preventDefault(); // ŸäŸÖŸÜÿπ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
            Checkout();
        });

        async function Checkout() {
            let cartItems = getCurrentLoggedInUserCartOrderedItems(); // ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©
            if (cartItems.length === 0) {
                alert("Your cart is empty. Please add items to your cart before checking out.");
                return;
            }

            let username = localStorage.getItem("username");
            if (!username) {
                ShowBootstrapToast("‚ùå Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã!", "danger");
                return;
            }


            let orderData = {
                orderId: Date.now(),
                username: username,
                orderDate: new Date().toISOString().split('T')[0], // ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ
                estimatedDelivery: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // +3 ÿ£ŸäÿßŸÖ
                order: cartItems
            };

            try {
                let response = await fetch("http://localhost:3000/checkout", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(orderData)
                });

                let result = await response.json();

                if (response.ok) {
                    ShowBootstrapToast(result.message, "success");
                } else {
                    ShowBootstrapToast(result.message, "danger");
                }
            } catch (error) {
                ShowBootstrapToast("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®", "danger");
            }

            // Clear the current user's cart after checkout
            // let carts = JSON.parse(localStorage.getItem("carts")) || [];
            // let userCartIndex = carts.findIndex(cart => cart.username === username);

            // if (userCartIndex !== -1) {
            //     carts[userCartIndex].order = []; // Clear the order for the current user
            //     localStorage.setItem("carts", JSON.stringify(carts));
            // }
            // updateCartCount(); // Update the cart count
            // Pass order details to the next page

            localStorage.setItem("orderDetails", JSON.stringify(orderData)); // Save order details in local storage
            window.location.href = "order-confirmation.html";

            // window.location.href = "order-confirmation.html"; // Redirect to order confirmation page
            // // Pass order details to the next
        }


    </script>
</body>

</html>
<!-- <i class="fa-solid fa-minus decrease-quantity" data-index="${index}"></i>
<i class="fa-solid fa-plus increase-quantity" data-index="${index}"></i> -->