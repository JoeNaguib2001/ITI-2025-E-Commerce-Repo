<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main-colors.css">
    <link rel="stylesheet" href="./css/shopstyle.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <title>Shop</title>
    <style>
        .promo-text {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            height: 100%;
        }

        .promo-text h3 {
            font-size: 1.8rem;
            color: #333;
        }

        .carousel-inner img {
            height: 600px;
            object-fit: cover;
            border-radius: 10px;
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: orange;
            color: black;
            border-radius: 50%;
            padding: 10px;
        }


        .product-card {
            text-align: center;
            padding: 15px;
            margin: 0 auto;
        }

        #productSlider {
            margin: auto;
        }


        .product-card img {
            height: 650px;
            object-fit: cover;
            border-radius: 10px;
            transition: transform 0.3s ease-in-out;
        }

        .product-card:hover img {
            transform: scale(1.1);
            /* تكبير الصورة قليلاً عند التمرير عليها */
        }

        .product-info h5 {
            font-size: 18px;
            margin: 10px 0;
        }

        .product-info p {
            font-size: 16px;
            color: w;
        }

        .carousel-item {
            transition: transform 0.5s ease;
        }
    </style>
</head>

<body>
    <!-- Nav -->
    <div class="container-fluid px-0">
        <div id="navbar"></div>
        <!-- Toast Container -->
        <div class="toast-container position-fixed top-0 end-0 p-3">
            <div id="bootstrapToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <strong class="me-auto" id="toastTitle">Notification</strong>
                    <small>Just now</small>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body text-dark" id="toastMessage">Message goes here.</div>
            </div>
        </div>
        <!-- End Toast Container -->

        <!-- Categories Nav -->
        <div class="d-flex categories-container-nav" id="categories-container-nav">
            <ul id="categories-container-nav-id"
                style="list-style-type: none; padding-left: 10px; margin: 0; display: flex;"></ul>
        </div>

        <div class="container-fluid d-flex justify-content-center align-items-center"
            style="background-image: url(./Images/design_a_background_image_for_an_ecommerce_website_but_dont_design_buttons_just_the_image_and_some__qv06hicou6ak412v6nj0_2.png);
            background-size: cover; background-repeat: no-repeat; height: 80vh; display: flex; align-items: center; justify-content: center;">
            <div class="d-flex flex-column gap-2" style="width: 60%;">
                <h2 style="font-weight: 300; margin-bottom: 30px;" class="text-white">
                    50% Discounts For Limited Time
                </h2>

                <h3 style="font-weight: 200; margin-bottom: 30px;" class="text-white">
                    We Deliver All Around Egypt ! </h3>

                <h3 style="font-weight: 200;" class="text-white">
                    Free Delivery For Orders Over <span style="font-weight:400;" class="text-white">500.00 EGP</span>
                </h3>

                <button
                    style="width: 300px; background-color: #ff5733; color: white; border: none; border-radius: 25px; padding: 15px 20px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    Shop Now
                </button>
            </div>
        </div>

        <!-- Categories Cards -->
        <div class="d-flex flex-wrap justify-content-center categories-container" id="categories-container"
            style="display: none !important;">
            Categories will be dynamically rendered here
        </div>
        <!-- First Carousel with Promo Text -->
        <div class="container-fluid my-5">
            <div class="d-flex align-items-center">
                <!-- الكاروسيل الأول -->
                <div class="col-md-9">
                    <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="0" class="active"
                                aria-current="true" aria-label="Slide 1"></button>
                            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="1"
                                aria-label="Slide 2"></button>
                            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="2"
                                aria-label="Slide 3"></button>
                            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="3"
                                aria-label="Slide 4"></button>
                        </div>
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="./Images/carousel_1/blonde1.png" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="./Images/carousel_1/blonde2.png" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="./Images/carousel_1/blonde3.png" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="./Images/carousel_1/blonde4.png" class="d-block w-100" alt="...">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>

                <!-- النص الدعائي بجانب الكاروسيل -->
                <div class="col-md-3 d-flex align-items-center justify-content-center text-center">
                    <div class="promo-text py-5 px-5">
                        <h3 style="font-weight: 100;">Summer Collection</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- 🟢 الكاروسيل الثاني (بشكل منفصل عن الأول) -->
        <div class="d-flex products-carousel bg-black text-white">
            <div class="left-side" style="width: 30%;">
                <div id="productSlider" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="product-card">
                                <img src="./Images/carousel_2/product_1.png" alt="Product 1">
                                <div class="product-info">
                                    <h5>Product 1</h5>
                                    <p>$199.99</p>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="product-card">
                                <img src="./Images/carousel_2/product_2.jpg" alt="Product 1">
                                <div class="product-info">
                                    <h5>Product 2</h5>
                                    <p>$249.99</p>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="product-card">
                                <img src="./Images/carousel_2/product_3.jpg" alt="Product 2">
                                <div class="product-info">
                                    <h5>Product 3</h5>
                                    <p>$349.99</p>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="product-card">
                                <img src="./Images/carousel_2/product_4.png" alt="Product 2">
                                <div class="product-info">
                                    <h5>Product 3</h5>
                                    <p>$349.99</p>
                                </div>
                            </div>
                        </div>

                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#productSlider"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#productSlider"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>

            <div class="right-side d-flex justify-content-center align-self-center" style="width: 80%;">
                <h1 style="font-weight: 100;">New Collection</h1>
            </div>
        </div>
        <!-- 🟢 المنتجات -->
        <div class="container-fluid random-products-container">
            <section class="shopping-row">
                <div class="row" id="product-container" style="padding:0px;"></div>
            </section>
        </div>

    </div>
    </div>


    <!-- Products Section -->
    <div class="container-fluid random-products-container">
        <section class="shopping-row">
            <div class="row" id="product-container" style="padding:0px;"></div>
        </section>
    </div>




    <!-- Pagination -->
    <div class="pagination-container d-flex justify-content-center mt-5 pt-3 pb-3" style="background-color: black;">
        <nav aria-label="Page navigation" style="background-color: black;">
            <ul class="pagination" style="background-color: black;">
                <li class="page-item disabled" id="prev-page">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                Page numbers will be dynamically added here
                <li class="page-item" id="next-page">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    </div>
    <!-- Load NavBar -->
    <script src="./navbar/navbar.js"></script>

    <!-- Load Boostrap JS -->
    <script src="./js/bootstrap.bundle.min.js"></script>



    <script>
        window.addEventListener("load", function () {
            let welcomeMessage = localStorage.getItem("welcomeMessage");
            if (welcomeMessage) {
                ShowBootstrapToast(`${welcomeMessage}`, "success");
                localStorage.removeItem("welcomeMessage"); // علشان متتكررش التوست كل مرة يدخل الصفحة
            }
        });

        let currentPage = 1;
        const itemsPerPage = 12;
        let productsList = [];
        let mode = "random";
        fetchProducts();


        function renderPagination(totalItems) {
            const paginationContainer = document.querySelector(".pagination");
            paginationContainer.innerHTML = ""; // مسح الأزرار القديمة

            const totalPages = Math.ceil(totalItems / itemsPerPage);

            // زر السابق
            const prevPageItem = document.createElement("li");
            prevPageItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevPageItem.innerHTML = `<a class="page-link" href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>`;
            prevPageItem.addEventListener("click", () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderProductsPaginated();
                    renderPagination(totalItems);
                }
            });
            paginationContainer.appendChild(prevPageItem);

            // أزرار الأرقام
            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement("li");
                pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                pageItem.addEventListener("click", () => {
                    currentPage = i;
                    renderProductsPaginated();
                    renderPagination(totalItems);
                });
                paginationContainer.appendChild(pageItem);
            }

            // زر التالي
            const nextPageItem = document.createElement("li");
            nextPageItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextPageItem.innerHTML = `<a class="page-link" href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>`;
            nextPageItem.addEventListener("click", () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderProductsPaginated();
                    renderPagination(totalItems);
                }
            });
            paginationContainer.appendChild(nextPageItem);
        }
        function renderProductsPaginated() {
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            // Filter products based on the selected category
            let dataSource;
            if (mode != "random") {
                dataSource = filteredProducts;
            }
            else {
                dataSource = productsList;
            }

            const paginatedProducts = dataSource.slice(start, end);

            const productContainer = document.getElementById("product-container");
            productContainer.innerHTML = ""; // Clear existing products
            renderProducts(paginatedProducts);
        }
        async function fetchProducts() {
            try {
                let response = await fetch('./Data/products.json');
                productsList = await response.json();
                // render first page of products based on page size, current page = 1
                renderProductsPaginated();

                //create pagination after fetching the whole products from the Json file
                renderPagination(productsList.length);
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        }
        function renderProducts(products) {
            const row = document.querySelector(".row");

            products.forEach(product => {
                const productDiv = document.createElement("div");
                productDiv.addEventListener("click", function () {
                    productDiv.classList.toggle("flipped");
                });


                // col     = extra small = <= 576px
                // col-sm  = small       =   576:768
                // col-md  = medium      =   769:992
                // col-lg  = large       =   993:1200
                // col-xl  = extra large = > 1201
                productDiv.classList.add("product-container", "col-12", "col-sm-12", "col-md-6", "col-lg-4", "col-xl-3", "p-4", "text-center", "shadow-sm");

                productDiv.innerHTML = `
                <div class="product">
                    <div class="front-card">
                        <a href="#" class="add-to-fav"><i class="fa-solid fa-plus"> </i> </a>
                        <img src="${product.image}" alt="${product.title}">
                        <br>
                        <span class="product-name">${product.title}</span>
                        <br>
                        <span class="product-price">$${product.price}</span>
                        <br>
                        <span class="rating-text">(${product.rating.rate} ⭐ from ${product.rating.count} reviews)</span>
                        <br>
                        <button class="add-to-cart add-to-cart-btn"> Add to Cart</button>
                    </div>
                    <div>
                    <div class="back-card">
                        <span> ${product.description}</span>
                    </div>
                </div>
            `;

                row.appendChild(productDiv);
                setupRating(productDiv, product.rating.rate);
                setupAddToFavorites(productDiv, product);
                setupAddToCart(productDiv, product);
            });
        }

        // fetchProducts will load Initial Page and Initial Pagination



        async function fetchCategories() {
            try {
                let response = await fetch('./Data/categories.json');
                let categories = await response.json();
                renderCategories(categories);
            } catch (error) {
                console.error("Error fetching categories:", error);
            }
        }

        let filteredProducts = []; // لتخزين المنتجات الخاصة بكل فئة
        function renderCategories(categories) {
            const categoriesContainer = document.getElementById("categories-container");
            const categoriesContainer2 = document.getElementById("categories-container-nav-id");
            categoriesContainer.innerHTML = "";

            categories.forEach(category => {
                const categoryDiv = document.createElement("a");
                const li = document.createElement("li");
                li.innerText = category.name;
                categoriesContainer2.appendChild(li);
                categoryDiv.style.textDecoration = "none";
                categoryDiv.href = "#";
                categoryDiv.classList.add("card", "m-2", "text-center", "shadow-sm");

                categoryDiv.innerHTML = `
            <h5 class="card-title">${category.name}</h5>
        `;
                li.addEventListener("click", function () {
                    currentPage = 1;
                    if (category.name == "All Categories") {
                        mode = "random";
                    }
                    else {
                        filteredProducts = productsList.filter(product => product.category === category.name);
                        mode = "category";
                    }

                    renderProductsPaginated();
                    renderPagination(filteredProducts.length);
                });


                categoryDiv.addEventListener("click", function () {
                    currentPage = 1;
                    if (category.name == "All Categories") {
                        mode = "random";
                    }
                    else {
                        filteredProducts = productsList.filter(product => product.category === category.name);
                        mode = "category";
                    }

                    renderProductsPaginated();
                    renderPagination(filteredProducts.length);
                });

                categoriesContainer.appendChild(categoryDiv);
            });
        }
        fetchCategories();




        function setupRating(productDiv, rating) {
            const stars = productDiv.querySelectorAll('.star');
            let fixedRating = Math.round(rating);

            stars.forEach(star => {
                if (star.dataset.index <= fixedRating) {
                    star.classList.add('filled');
                }
            });
        }

        function setupAddToCart(productDiv, product) {
            const addToCartBtn = productDiv.querySelector(".add-to-cart");
            addToCartBtn.addEventListener("click", (event) => {
                event.stopPropagation(); // Prevent the click event from propagating to the product
                addToCart(product);
                updateCartCount();
                ShowBootstrapToast("Product Added To Shopping Cart Successfully !", "success");
            });
        }

        function addToCart(product) {
            if (localStorage.getItem("isSignedIn") !== "true") {
                alert("يجب تسجيل الدخول أولاً لإضافة المنتج إلى السلة.");
                return;
            }

            let username = localStorage.getItem("username"); // Assuming the username is stored in localStorage
            if (!username) {
                alert("User not found. Please log in again.");
                return;
            }

            let carts = JSON.parse(localStorage.getItem("carts")) || [];
            let userCart = carts.find(cart => cart.username === username);

            if (!userCart) {
                userCart = { username: username, order: [] };
                carts.push(userCart);
            }

            let existingProduct = userCart.order.find(item => item.id === product.id);
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                userCart.order.push({ ...product, quantity: 1 });
            }

            localStorage.setItem("carts", JSON.stringify(carts));
        }

        function setupAddToFavorites(productDiv, product) {
            const addToFavoritesBtn = productDiv.querySelector(".add-to-fav");
            addToFavoritesBtn.addEventListener("click", (event) => {
                event.stopPropagation(); // Prevent the click event from propagating to the product
                addToFavorites(product);
            });
        }
        function addToFavorites(product) {
            if (localStorage.getItem("isSignedIn") !== "true") {
                alert("يجب تسجيل الدخول أولاً لإضافة المنتج إلى المفضلة.");
                return;
            }

            let username = localStorage.getItem("username"); // Assuming the username is stored in localStorage
            if (!username) {
                alert("User not found. Please log in again.");
                return;
            }

            let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
            let userFavorites = favorites.find(fav => fav.username === username);

            if (!userFavorites) {
                userFavorites = { username: username, favorites: [] };
                favorites.push(userFavorites);
            }

            let existingProduct = userFavorites.favorites.find(item => item.id === product.id);
            if (!existingProduct) {
                userFavorites.favorites.push(product);
                ShowBootstrapToast("Product Added To Wish List !", "success");
            }

            else {
                ShowBootstrapToast("Product Already In Wish List !", "danger");
            }

            localStorage.setItem("favorites", JSON.stringify(favorites));
        }

        function sortProducts(criteria) {
            let sortedProducts = [...productsList];

            if (criteria === "high-to-low") {
                sortedProducts.sort((a, b) => b.price - a.price);
            } else if (criteria === "low-to-high") {
                sortedProducts.sort((a, b) => a.price - b.price);
            } else if (criteria === "highest-rating") {
                sortedProducts.sort((a, b) => b.rating.rate - a.rating.rate);
            }

            renderProducts(sortedProducts);
        }


        document.addEventListener("DOMContentLoaded", function () {
            let searchInput = document.querySelector("#search-box");
            if (searchInput) {
                searchInput.addEventListener("input", function () {
                    let query = searchInput.value.trim().toLowerCase();
                    searchProducts(query);
                });
            }
        });

        function searchProducts(query) {
            console.log(query);
            let products = document.querySelectorAll(".product");
            let productContainer = document.getElementById("product-container");

            products.forEach(product => {
                let name = product.querySelector(".product-name").innerText.toLowerCase();

                if (name.includes(query.toLowerCase())) {
                    product.parentElement.classList.remove("d-none"); // Show the product
                } else {
                    product.parentElement.classList.add("d-none"); // Hide the product
                }
            });
        }


        if (localStorage.getItem("searchQuery") != null) {
            setTimeout(() => {
                let searchBar = document.getElementById("search-box");
                if (!searchBar) {
                    return;
                }
                let storedQuery = localStorage.getItem("searchQuery") || "";
                searchBar.value = storedQuery;
                if (storedQuery) {
                    searchProducts(storedQuery);
                }
                localStorage.setItem("searchQuery", "");
            }, 300);

        }

        //Bootstrap Toast Function
        window.ShowBootstrapToast = function (message, type) {
            let toastEl = document.getElementById("bootstrapToast");
            let toastBody = document.getElementById("toastMessage");
            let toastHeader = document.getElementById("toastTitle");

            // تغيير لون العنوان حسب نوع الرسالة
            let bgColor = type === "success" ? "text-success" : "text-danger";
            toastHeader.className = `me-auto ${bgColor}`;

            // تعيين الرسالة
            toastBody.innerText = message;

            // عرض التوست
            let toast = new bootstrap.Toast(toastEl);
            toast.show();
        };



    </script>


</body>

</html>
<!-- <div class="product">
                    <img src="./Images/20240815_105001.jpg" alt="">
                    <br>
                    <span class="product-name">Product 1</span>
                    <br>
                    <span class="product-price">$100</span>
                    <div class="stars-container">
                        <div class="star" data-index="1"></div>
                        <div class="star" data-index="2"></div>
                        <div class="star" data-index="3"></div>
                        <div class="star" data-index="4"></div>
                        <div class="star" data-index="5"></div>
                    </div>
        
                    <br>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div> -->
<!-- <div class="product">
                    <img src="./Images/20240815_105001.jpg" alt="">
                    <br>
                    <span class="product-name">Product 1</span>
                    <br>
                    <span class="product-price">$100</span>
                    <div class="stars-container">
                        <div class="star" data-index="1"></div>
                        <div class="star" data-index="2"></div>
                        <div class="star" data-index="3"></div>
                        <div class="star" data-index="4"></div>
                        <div class="star" data-index="5"></div>
                    </div>
        
                    <br>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
                <div class="product">
                    <img src="./Images/20240815_105001.jpg" alt="">
                    <br>
                    <span class="product-name">Product 1</span>
                    <br>
                    <span class="product-price">$100</span>
                    <div class="stars-container">
                        <div class="star" data-index="1"></div>
                        <div class="star" data-index="2"></div>
                        <div class="star" data-index="3"></div>
                        <div class="star" data-index="4"></div>
                        <div class="star" data-index="5"></div>
                    </div>
                    <br>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div>
        
                <div class="product">
                    <img src="./Images/20240815_105001.jpg" alt="">
                    <br>
                    <span class="product-name">Product 1</span>
                    <br>
                    <span class="product-price">$100</span>
                    <div class="stars-container">
                        <div class="star" data-index="1"></div>
                        <div class="star" data-index="2"></div>
                        <div class="star" data-index="3"></div>
                        <div class="star" data-index="4"></div>
                        <div class="star" data-index="5"></div>
                    </div>
        
                    <br>
                    <button class="add-to-cart-btn">Add to Cart</button>
                </div> -->

<!-- <br> -->

<!-- <div class="stars-container">
                                <div class="star" data-index="1"></div>
                                <div class="star" data-index="2"></div>
                                <div class="star" data-index="3"></div>
                                <div class="star" data-index="4"></div>
                                <div class="star" data-index="5"></div> -->

<!-- // async function fetchProducts() {
        // try {
        // let response = await fetch('https://fakestoreapi.com/products');
        // productsList = await response.json();
        // renderProducts(productsList);
        // } catch (error) {
        // console.error("Error fetching products:", error);
        // }
        // } -->